---
title: Saving data from a web page (Blob)
generated: 1701279907847
lastUpdated: 2024-02-25
---

You can fetch data from Val Town from any web page using HTTP vals and some JavaScript.

This article will use [blob storage](/std/blob) to store the data. You can also read teh [SQLite version of this article](/guides/saving-data-from-a-web-page-sqlite/).

:::note
Blob storage in Val Town is a versatile key-value store that enables you to store a wide variety of data types, including binary, JSON, XML, and more. Its simplicity makes it suitable for various use cases, from storing simple text, images to more complex data structures. However, it's important to note that blob storage does not support transactions, which means it might not be the best choice for use cases where data concurrency is a concern. This limitation highlights the need for careful consideration when designing systems that require concurrent data modifications or access.
:::

## 1. Create a HTTP val to store some state

The val below creates an HTTP API that allows for saving _comments_. It accepts `POST` requests and then adds a received comment to a list stored in blob storage. Create a copy of it and name it `appendToComments`.

```ts val
import { blob } from "https://esm.town/v/std/blob";

export default async function (req: Request): Promise<Response> {
  // Accept only POST requests
  if (req.method !== "POST") {
    return new Response("Method Not Allowed", { status: 405 });
  }

  // Extract the JSON body from the request to get the comment data.
  const commentData = await req.json();
  
  // Retrieve the existing comments from the blob storage. If it doesn't exist, initialize it as an empty array.
  const comments = (await blob.getJSON("comments-list") as any[]) ?? [];
  
  // Add the new comment data to the array of comments.
  comments.push(commentData);
  
  // Save the updated comments array back to the blob storage.
  await blob.setJSON("comments-list", comments);
  
  return new Response("OK", { status: 200 });
}
```

Make sure to mark it as [HTTP val](/types/http) and make it [public](/reference/permissions/).


## 2. Use this JavaScript snippet on your webpage

Copy the generated API URL for the val created in the previous step.

![Screenshot showing the location of the API URL](./saving-data-from-a-web-page/url.png)

The below JavaScript snippet sends data to your `appendToComments` val which saves it in the blob storage.

```js
// change this URL to your appendToComments's API URL!
fetch("https://user-appendtocomments.web.val.run", {
  method: "POST",
  headers: {
    "Content-Type": "application/json",
  },
  body: JSON.stringify({
    author: "user",
    content: "Hello world!",
  }),
}).then((r) => {
  // Status will be 200 if everything went okay
  console.log(r.status, r.statusText);
});
```


## 3. Read comments

To read the first comment you can expand the existing val or create a new HTTP val, like here:

```ts val
import { blob } from "https://esm.town/v/std/blob";

export default async function (req: Request): Promise<Response> {
  // Accept only GET requests
  if (req.method !== "GET") {
    return new Response("Method Not Allowed", { status: 405 });
  }

  // Retrieve the comments array from the blob storage. If it doesn't exist, initialize it as an empty array.
  const comments = (await blob.getJSON("comments-list") as any[]) ?? [];

  // Check if there are any comments. If not, return a message indicating no comments are available.
  if (comments.length === 0) {
    return new Response("No comments available", { status: 404 });
  }

  // Return the first element of the comments array as a JSON response.
  return new Response(JSON.stringify(comments[0]), {
    headers: { "Content-Type": "application/json" },
  });
}
```

Copy the val, mark it as HTTP val and make it public.

Go ahead and check it by reviewing the contents of the "browser preview" tab. You can also do this by visiting the provided API URL in your browser; this action will automatically send a GET request. Alternatively, you can run the following JavaScript in your browser's DevTools for more controller interaction:

```js
const r = await fetch("https://user-getfirstcomment.web.val.run");
console.log(await r.json());
```


## 4. Use anything that supports HTTP!

Like `cURL`:

```bash
curl https://user-getfirstcomment.web.val.run
## "hello world!"
```

Or `python3`:

```python
import json, urllib.request
body = urllib.request.urlopen("https://user-getfirstcomment.web.val.run").read()
print(json.loads(body)) # hello world!
```